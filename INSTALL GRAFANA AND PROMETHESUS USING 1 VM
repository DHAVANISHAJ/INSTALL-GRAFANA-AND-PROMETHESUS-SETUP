INSTALL GRAFANA AND PROMETHESUS USING 1 VM

STEP 1: Update and Install Dependencies
sudo yum update -y
sudo yum install wget curl vim -y

 STEP 2: Create User & Directory Structure for Prometheus
sudo useradd --no-create-home --shell /bin/false prometheus

sudo mkdir /etc/prometheus
sudo mkdir /var/lib/prometheus

sudo chown prometheus:prometheus /etc/prometheus /var/lib/prometheus

STEP 3: Download and Install Prometheus
3.1 Download Prometheus
cd /opt
wget https://github.com/prometheus/prometheus/releases/download/v2.51.1/prometheus-2.51.1.linux-amd64.tar.gz
tar -xvf prometheus-2.51.1.linux-amd64.tar.gz
mv prometheus-2.51.1.linux-amd64 prometheus
3.2 Move binaries
sudo cp prometheus/prometheus /usr/local/bin/
sudo cp prometheus/promtool /usr/local/bin/
3.3 Set permissions
sudo chown prometheus:prometheus /usr/local/bin/prometheus /usr/local/bin/promtool

STEP 4: Create Prometheus Config File
sudo vim /etc/prometheus/prometheus.yml
Paste the below content:
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "node-exporter"
    static_configs:
      - targets: ["localhost:9100"]
Then:
sudo chown prometheus:prometheus /etc/prometheus/prometheus.yml

STEP 5: Create Prometheus Systemd Service
sudo vim /etc/systemd/system/prometheus.service
Paste:
[Unit]
Description=Prometheus Monitoring
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
ExecStart=/usr/local/bin/prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.path=/var/lib/prometheus

[Install]
WantedBy=multi-user.target

STEP 6: Start Prometheus
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus
sudo systemctl status prometheus
Visit:
http://<your-ec2-ip>:9090

STEP 7: Install and Start Node Exporter
7.1 Download Node Exporter
cd /opt
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz
tar -xvf node_exporter-1.8.1.linux-amd64.tar.gz
mv node_exporter-1.8.1.linux-amd64 node_exporter
7.2 Create Systemd Service
sudo vim /etc/systemd/system/node_exporter.service
Paste:
[Unit]
Description=Node Exporter
After=network.target

[Service]
User=nobody
ExecStart=/opt/node_exporter/node_exporter

[Install]
WantedBy=default.target
Then start it:
sudo systemctl daemon-reload
sudo systemctl enable node_exporter
sudo systemctl start node_exporter
sudo systemctl status node_exporter
Check on browser:
http://<your-ec2-ip>:9100/metrics

STEP 8: Install Grafana
8.1 Add Grafana Repo
sudo tee /etc/yum.repos.d/grafana.repo <<EOF
[grafana]
name=Grafana OSS
baseurl=https://packages.grafana.com/oss/rpm
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packages.grafana.com/gpg.key
EOF
8.2 Install & Start Grafana
sudo yum install grafana -y
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server
Visit:
http://<your-ec2-ip>:3000
Default credentials:
â€¢	Username: admin
â€¢	Password: admin (youâ€™ll be prompted to change it)

STEP 9: Configure Prometheus in Grafana
1.	Go to http://<your-ip>:3000
2.	Login
3.	Go to Settings â†’ Data Sources
4.	Click Add data source
5.	Choose Prometheus
6.	Set URL: http://localhost:9090
7.	Click Save & Test

ðŸ”¹ STEP 10: Create Dashboard
1.	Go to Create â†’ Dashboard
2.	Click Add new panel
3.	In query box, try:
node_cpu_seconds_total
4.	Visualize, then click Apply
5.	Save the dashboard

 OPTIONAL: Import Node Exporter Full Dashboard
1.	Go to: https://grafana.com/grafana/dashboards/1860
2.	Copy the Dashboard ID: 1860
3.	In Grafana:
o	Click + > Import
o	Paste the ID
o	Select Prometheus as data source
o	Click Import

